<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Grimoire - Standalone</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Crimson+Text:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
/* All CSS bundled inline */
:root {
    --page-bg: #f5e6d0;
    --ink-color: #2c2c2c;
    --ink-light: #5a5a5a;
    --gold-accent: #c5a059;
    --crimson: #8b0000;
    --wood-dark: #3e2723;
    --wood-light: #5d4037;
    --font-header: 'Cinzel', serif;
    --font-body: 'Crimson Text', serif;
}

body {
    margin: 0;
    overflow: hidden;
    background: #1a0f0a;
    font-family: var(--font-body);
    color: var(--ink-color);
}

.wood-table {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: radial-gradient(circle at center, var(--wood-light), var(--wood-dark));
    z-index: 0;
}

#candle-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 5;
    mix-blend-mode: overlay;
}

.ui-controls {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 100;
}

.magic-btn {
    background: #000;
    border: 2px solid var(--gold-accent);
    color: var(--gold-accent);
    padding: 12px 30px;
    font-family: var(--font-header);
    font-size: 18px;
    cursor: pointer;
    box-shadow: 0 0 15px rgba(197, 160, 89, 0.3);
    transition: all 0.3s;
}

.magic-btn:hover {
    background: var(--gold-accent);
    color: #000;
    box-shadow: 0 0 30px rgba(197, 160, 89, 0.6);
}

#book-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 50;
    transition: transform 0.5s ease-in-out, opacity 0.5s;
    opacity: 0;
    pointer-events: none;
    transform: scale(0.9) translateY(20px);
}

#book-container.open {
    opacity: 1;
    pointer-events: auto;
    transform: scale(1) translateY(0);
}

.book {
    width: 1000px;
    height: 700px;
    display: flex;
    position: relative;
    box-shadow: 0 20px 50px rgba(0,0,0,0.6);
}

.page {
    flex: 1;
    background: var(--page-bg);
    padding: 40px;
    position: relative;
    box-shadow: inset 0 0 30px rgba(0,0,0,0.1);
    background-image: repeating-linear-gradient(
        transparent,
        transparent 2px,
        rgba(0,0,0,0.02) 2px,
        rgba(0,0,0,0.02) 4px
    );
}

.left-page {
    border-radius: 5px 0 0 5px;
    border-right: 1px solid rgba(0,0,0,0.1);
    transform-origin: right;
}

.right-page {
    border-radius: 0 5px 5px 0;
    border-left: 1px solid rgba(0,0,0,0.05);
}

.book-spine {
    position: absolute;
    left: 50%;
    top: 0;
    bottom: 0;
    width: 40px;
    transform: translateX(-50%);
    background: linear-gradient(90deg, rgba(0,0,0,0.2), transparent 50%, rgba(0,0,0,0.2));
    pointer-events: none;
    z-index: 10;
}

.page-number {
    position: absolute;
    bottom: 20px;
    width: 100%;
    text-align: center;
    font-family: var(--font-header);
    color: var(--ink-light);
    left: 0;
}

.chapter-title {
    font-family: var(--font-header);
    font-size: 36px;
    text-align: center;
    margin: 0 0 10px 0;
    color: var(--crimson);
}

.ink-separator {
    height: 2px;
    background: url('data:image/svg+xml;utf8,<svg width="100" height="2" viewBox="0 0 100 2" xmlns="http://www.w3.org/2000/svg"><path d="M0,1 Q50,2 100,1" stroke="%232c2c2c" fill="none"/></svg>');
    background-size: cover;
    margin: 0 auto 30px auto;
    width: 80%;
    opacity: 0.5;
}

#page-header {
    font-family: var(--font-header);
    font-size: 28px;
    border-bottom: 2px solid var(--gold-accent);
    padding-bottom: 10px;
    margin-top: 0;
}

#book-nav {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
}

.nav-entry {
    font-size: 18px;
    cursor: pointer;
    position: relative;
    padding: 5px 10px;
    transition: color 0.2s;
}

.nav-entry:hover {
    color: var(--crimson);
    text-decoration: underline;
}

.nav-entry.active {
    font-weight: bold;
    color: var(--crimson);
}

.nav-entry.active::before {
    content: "‚úíÔ∏è";
    position: absolute;
    left: -20px;
    top: 5px;
    font-size: 14px;
}

.ink-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
    gap: 15px;
    padding-top: 20px;
}

.ink-slot {
    width: 70px;
    height: 70px;
    border: 2px solid var(--ink-light);
    border-radius: 4px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 32px;
    position: relative;
    cursor: pointer;
    transition: transform 0.2s;
}

.ink-slot:hover {
    transform: scale(1.05);
    border-color: var(--crimson);
}

.ink-slot .qty {
    position: absolute;
    bottom: -5px;
    right: -5px;
    background: var(--page-bg);
    border: 1px solid var(--ink-color);
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 12px;
    font-weight: bold;
}

.ink-list-item {
    padding: 10px 0;
    border-bottom: 1px dashed rgba(0,0,0,0.2);
    display: flex;
    justify-content: space-between;
}

.ink-list-item strong {
    font-family: var(--font-header);
    font-size: 18px;
}

.portrait-card {
    border: 3px double var(--ink-color);
    padding: 15px;
    margin-bottom: 20px;
    background: rgba(0,0,0,0.03);
    display: flex;
    gap: 20px;
    align-items: center;
}

.portrait-sketch {
    font-size: 50px;
    filter: sepia(1) contrast(1.2);
}

::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-thumb { background: var(--gold-accent); border-radius: 3px; }
    </style>
</head>
<body>
    <div class="wood-table"></div>
    
    <canvas id="candle-canvas"></canvas>

    <div id="book-container">
        <div class="book">
            <div class="page left-page">
                <div class="page-content">
                    <h1 class="chapter-title">Index</h1>
                    <div class="ink-separator"></div>
                    <nav id="book-nav"></nav>
                </div>
                <div class="page-number">I</div>
            </div>

            <div class="page right-page">
                <div class="page-content">
                    <h2 id="page-header">Inventory</h2>
                    <div id="book-view-container"></div>
                </div>
                <div class="page-number">II</div>
            </div>
            
            <div class="book-spine"></div>
        </div>
    </div>

    <div class="ui-controls">
        <button id="btn-toggle-book" class="magic-btn">Open Grimoire (B)</button>
    </div>

    <script>
// The Grimoire System - All code bundled inline

(function() {
    const TABS_CONFIG = [
        { id: "items", label: "Inventory", icon: "üì¶", type: "grid" },
        { id: "gear", label: "Equipment", icon: "‚öîÔ∏è", type: "grid" },
        { id: "team", label: "Companions", icon: "üë•", type: "team" },
        { id: "pets", label: "Familiars", icon: "üêæ", type: "grid" },
        { id: "skins", label: "Attire", icon: "üë§", type: "grid" },
        { id: "talents", label: "Talents", icon: "‚≠ê", type: "list" },
        { id: "vehicles", label: "Mounts", icon: "üêé", type: "list" },
        { id: "ai", label: "Constructs", icon: "ü§ñ", type: "list" },
        { id: "alchemy", label: "Alchemy", icon: "‚öóÔ∏è", type: "grid" },
        { id: "skills", label: "Grimoire", icon: "üî∞", type: "list" },
        { id: "spirit", label: "Spirit", icon: "‚ú®", type: "list" },
        { id: "supernatural", label: "Arcane", icon: "üîÆ", type: "list" },
        { id: "quests", label: "Quests", icon: "üìú", type: "list" },
        { id: "drops", label: "Loot", icon: "üéÅ", type: "grid" },
        { id: "bestiary", label: "Bestiary", icon: "üìñ", type: "list" },
        { id: "missions", label: "Bounties", icon: "üó∫Ô∏è", type: "list" },
        { id: "map", label: "Atlas", icon: "üó∫Ô∏è", type: "list" },
        { id: "shop", label: "Merchant", icon: "üí∞", type: "grid" },
        { id: "settings", label: "Options", icon: "‚öôÔ∏è", type: "list" },
        { id: "controls", label: "Bindings", icon: "üïπÔ∏è", type: "list" }
    ];

    const PARTY_DATA = [
        { name: 'A1', role: 'Knight', sketch: 'üßî', desc: 'The bearer of the Blue Blade.' },
        { name: 'Missy', role: 'Sorceress', sketch: 'üë©‚Äçüé§', desc: 'Mistress of Purple Fire.' },
        { name: 'Unique', role: 'Rogue', sketch: 'ü•∑', desc: 'Shadow of the Orange Sun.' }
    ];

    class Inventory {
        constructor() {
            this.size = 30;
            this.items = new Array(this.size).fill(null);
            this.load();
            
            if (this.getAll().every(i => i === null)) {
                this.seed();
            }
        }

        seed() {
            const loot = [
                { name: "Ancient Sword", icon: "‚öîÔ∏è", quality: "common" },
                { name: "Health Potion", icon: "üß™", quality: "common", qty: 3 },
                { name: "Magic Scroll", icon: "üìú", quality: "rare" },
                { name: "Gold Ring", icon: "üíç", quality: "uncommon" }
            ];
            loot.forEach(item => this.addItem({
                ...item, 
                instanceId: Date.now() + Math.random(),
                desc: "A discovered item."
            }));
        }

        addItem(item) {
            const idx = this.items.findIndex(i => i === null);
            if (idx !== -1) {
                this.items[idx] = { ...item, qty: item.qty || 1 };
                this.save();
                return true;
            }
            return false;
        }

        moveItem(from, to) {
            if (from === to) return;
            const temp = this.items[to];
            this.items[to] = this.items[from];
            this.items[from] = temp;
            this.save();
        }

        getAll() { return this.items; }

        save() {
            localStorage.setItem('grimoire_inv', JSON.stringify(this.items));
        }

        load() {
            const data = localStorage.getItem('grimoire_inv');
            if (data) {
                try {
                    const parsed = JSON.parse(data);
                    this.items = parsed.length === this.size ? parsed : new Array(this.size).fill(null);
                } catch(e) { console.error(e); }
            }
        }
    }

    const Renderers = {
        grid: (container, tab, inv) => {
            container.innerHTML = `<div class="ink-grid" id="drag-grid"></div>`;
            const grid = container.querySelector('.ink-grid');
            
            inv.getAll().forEach((item, idx) => {
                const slot = document.createElement('div');
                slot.className = 'ink-slot';
                slot.dataset.index = idx;
                
                if (item) {
                    slot.draggable = true;
                    slot.innerHTML = `
                        <div>${item.icon}</div>
                        ${item.qty > 1 ? `<span class="qty">${item.qty}</span>` : ''}
                    `;
                    
                    slot.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('text/plain', idx);
                        slot.style.opacity = '0.5';
                    });
                    
                    slot.addEventListener('dragend', () => slot.style.opacity = '1');
                }
                
                slot.addEventListener('dragover', e => e.preventDefault());
                slot.addEventListener('drop', e => {
                    e.preventDefault();
                    const from = parseInt(e.dataTransfer.getData('text/plain'));
                    if (!isNaN(from)) {
                        inv.moveItem(from, idx);
                        Renderers.grid(container, tab, inv);
                    }
                });

                grid.appendChild(slot);
            });
        },
        
        team: (container) => {
            PARTY_DATA.forEach(char => {
                const card = document.createElement('div');
                card.className = 'portrait-card';
                card.innerHTML = `
                    <div class="portrait-sketch">${char.sketch}</div>
                    <div>
                        <div style="font-family: var(--font-header); font-size:24px;">${char.name}</div>
                        <div style="color: var(--crimson); font-style: italic;">${char.role}</div>
                        <div>${char.desc}</div>
                    </div>
                `;
                container.appendChild(card);
            });
        },

        list: (container, tab) => {
            container.innerHTML = `<p style="font-style:italic;">Notes on ${tab.label}...</p>`;
            for(let i=1; i<=5; i++) {
                const row = document.createElement('div');
                row.className = 'ink-list-item';
                row.innerHTML = `
                    <strong>${tab.label} Entry ${i}</strong>
                    <span>pg. ${100+i}</span>
                `;
                container.appendChild(row);
            }
        }
    };

    class GrimoireApp {
        constructor() {
            this.inv = new Inventory();
            this.activeTab = 'items';
            this.isOpen = false;
            this.init();
        }

        init() {
            this.renderNav();
            
            document.getElementById('btn-toggle-book').onclick = () => this.toggle();
            
            window.addEventListener('keydown', (e) => {
                if (e.key.toLowerCase() === 'b') this.toggle();
            });
            
            this.initCandle();
        }

        renderNav() {
            const nav = document.getElementById('book-nav');
            nav.innerHTML = '';
            TABS_CONFIG.forEach(tab => {
                const el = document.createElement('div');
                el.className = `nav-entry ${tab.id === this.activeTab ? 'active' : ''}`;
                el.innerText = tab.label;
                el.onclick = () => this.switchTab(tab);
                nav.appendChild(el);
            });
        }

        switchTab(tab) {
            this.activeTab = tab.id;
            this.renderNav();
            
            document.getElementById('page-header').innerText = tab.label;
            
            const container = document.getElementById('book-view-container');
            container.innerHTML = '';
            
            if (tab.type === 'grid') Renderers.grid(container, tab, this.inv);
            else if (tab.type === 'team') Renderers.team(container);
            else Renderers.list(container, tab);
        }

        toggle() {
            this.isOpen = !this.isOpen;
            const book = document.getElementById('book-container');
            const btn = document.getElementById('btn-toggle-book');
            
            if (this.isOpen) {
                book.classList.add('open');
                btn.innerText = "Close Grimoire";
                const tab = TABS_CONFIG.find(t => t.id === this.activeTab);
                this.switchTab(tab);
            } else {
                book.classList.remove('open');
                btn.innerText = "Open Grimoire (B)";
            }
        }

        initCandle() {
            const canvas = document.getElementById('candle-canvas');
            const ctx = canvas.getContext('2d');
            let w, h;
            
            const resize = () => {
                w = canvas.width = window.innerWidth;
                h = canvas.height = window.innerHeight;
            };
            window.onresize = resize;
            resize();

            const flicker = () => {
                ctx.clearRect(0,0,w,h);
                
                const radius = Math.min(w, h) * (0.6 + Math.random() * 0.05);
                const grad = ctx.createRadialGradient(w/2, h/2, 100, w/2, h/2, radius);
                grad.addColorStop(0, 'rgba(255, 160, 60, 0.1)');
                grad.addColorStop(1, 'rgba(0,0,0,0.8)');
                
                ctx.fillStyle = grad;
                ctx.fillRect(0,0,w,h);
                
                requestAnimationFrame(flicker);
            };
            flicker();
        }
    }

    window.onload = () => {
        window.Grimoire = new GrimoireApp();
    };

})();
    </script>
</body>
</html>
