<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unified Dashboard - Standalone</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
:root {
    --dash-bg: rgba(255, 255, 255, 0.05);
    --dash-blur: blur(20px);
    --dash-border: 1px solid rgba(255, 255, 255, 0.1);
    --dash-shadow: 0 20px 50px rgba(0,0,0,0.5);
    
    --text-main: #ffffff;
    --text-muted: #a0a0a0;
    
    --accent: #3b82f6; /* Blue */
    --accent-glow: rgba(59, 130, 246, 0.4);
    
    --font: 'Inter', sans-serif;
}

body {
    margin: 0;
    overflow: hidden;
    background: #111;
    font-family: var(--font);
    color: var(--text-main);
}

#bg-canvas {
    position: fixed;
    top: 0;
    left: 0;
    z-index: 0;
}

#ui-layer {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10;
}

#btn-dashboard {
    background: white;
    color: black;
    border: none;
    padding: 15px 40px;
    font-size: 18px;
    font-weight: 800;
    border-radius: 30px;
    cursor: pointer;
    box-shadow: 0 0 20px rgba(255,255,255,0.3);
    transition: transform 0.2s;
}

#btn-dashboard:hover {
    transform: scale(1.05);
}

/* DASHBOARD OVERLAY */
#dashboard-root {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 100;
    display: none;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.4);
    opacity: 0;
    transition: opacity 0.2s;
}

#dashboard-root.open {
    display: flex;
    opacity: 1;
}

.dashboard-window {
    width: 90%;
    max-width: 1100px;
    height: 80vh;
    background: rgba(20, 20, 25, 0.85);
    backdrop-filter: var(--dash-blur);
    border: var(--dash-border);
    border-radius: 20px;
    box-shadow: var(--dash-shadow);
    display: flex;
    overflow: hidden;
}

/* Sidebar (Categories) */
.dash-sidebar {
    width: 100px;
    background: rgba(0,0,0,0.2);
    border-right: var(--dash-border);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-top: 30px;
    gap: 20px;
}

.cat-btn {
    width: 60px;
    height: 60px;
    border-radius: 15px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 28px;
    cursor: pointer;
    color: var(--text-muted);
    transition: all 0.2s;
    background: transparent;
}

.cat-btn:hover {
    background: rgba(255,255,255,0.05);
    color: white;
}

.cat-btn.active {
    background: var(--accent);
    color: white;
    box-shadow: 0 0 20px var(--accent-glow);
}

/* Main Area */
.dash-main {
    flex: 1;
    display: flex;
    flex-direction: column;
}

/* Header (Sub-Tabs) */
.dash-header {
    height: 80px;
    border-bottom: var(--dash-border);
    display: flex;
    align-items: center;
    padding: 0 30px;
    gap: 30px;
}

.sub-tab-btn {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-muted);
    cursor: pointer;
    padding: 10px 0;
    position: relative;
    transition: color 0.2s;
}

.sub-tab-btn:hover {
    color: white;
}

.sub-tab-btn.active {
    color: white;
}

.sub-tab-btn.active::after {
    content: '';
    position: absolute;
    bottom: -29px; /* Align with header border */
    left: 0;
    width: 100%;
    height: 3px;
    background: var(--accent);
    border-radius: 3px 3px 0 0;
    box-shadow: 0 -5px 15px var(--accent-glow);
}

.close-btn {
    margin-left: auto;
    font-size: 24px;
    cursor: pointer;
    color: var(--text-muted);
}

/* Content */
.dash-content {
    flex: 1;
    padding: 30px;
    overflow-y: auto;
}

/* Grid View */
.item-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
    gap: 15px;
}

.item-slot {
    aspect-ratio: 1;
    background: rgba(255,255,255,0.05);
    border-radius: 12px;
    border: 1px solid transparent;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 30px;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
}

.item-slot:hover {
    background: rgba(255,255,255,0.1);
    border-color: rgba(255,255,255,0.2);
    transform: translateY(-2px);
}

.item-slot .qty {
    position: absolute;
    bottom: 5px;
    right: 5px;
    font-size: 11px;
    background: black;
    padding: 2px 5px;
    border-radius: 8px;
}

/* Team View */
.team-list {
    display: flex;
    gap: 20px;
}

.team-card {
    width: 250px;
    height: 350px;
    background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.01));
    border-radius: 20px;
    border: var(--dash-border);
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.team-avatar {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: rgba(0,0,0,0.3);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 50px;
    margin-bottom: 20px;
    border: 2px solid var(--accent);
}

.team-name {
    font-size: 24px;
    font-weight: 800;
    margin-bottom: 5px;
}

.team-role {
    color: var(--accent);
    text-transform: uppercase;
    font-size: 12px;
    letter-spacing: 2px;
    margin-bottom: 20px;
}

/* Generic Info */
.info-panel {
    text-align: center;
    padding-top: 50px;
    color: var(--text-muted);
}
    </style>
</head>
<body>
    <canvas id="bg-canvas"></canvas>

    <div id="ui-layer">
        <button id="btn-dashboard">OPEN DASHBOARD (TAB)</button>
    </div>

    <!-- Dashboard Root -->
    <div id="dashboard-root"></div>

    <script>
// Inventory Class
class Inventory {
    constructor() {
        this.size = 60;
        this.items = new Array(this.size).fill(null);
        this.load();
    }

    addItem(item) {
        if (item.stackable) {
            const existingIndex = this.items.findIndex(i => i && i.id === item.id && i.qty < i.maxStack);
            if (existingIndex !== -1) {
                this.items[existingIndex].qty++;
                this.save();
                return true;
            }
        }

        const emptyIndex = this.items.findIndex(i => i === null);
        if (emptyIndex !== -1) {
            this.items[emptyIndex] = {
                instanceId: Date.now() + Math.random(),
                ...item,
                qty: item.qty || 1
            };
            this.save();
            return true;
        }
        return false;
    }

    removeItem(instanceId) {
        const index = this.items.findIndex(i => i && i.instanceId === instanceId);
        if (index !== -1) {
            this.items[index] = null;
            this.save();
        }
    }

    moveItem(fromIndex, toIndex) {
        if (fromIndex < 0 || fromIndex >= this.size || toIndex < 0 || toIndex >= this.size) return false;
        if (fromIndex === toIndex) return true;

        const itemFrom = this.items[fromIndex];
        const itemTo = this.items[toIndex];

        this.items[toIndex] = itemFrom;
        this.items[fromIndex] = itemTo;

        this.save();
        return true;
    }

    getAll() {
        return this.items;
    }

    save() {
        localStorage.setItem('bag_system_inventory', JSON.stringify(this.items));
    }

    load() {
        const data = localStorage.getItem('bag_system_inventory');
        if (data) {
            try {
                const parsed = JSON.parse(data);
                if (Array.isArray(parsed)) {
                     this.items = new Array(this.size).fill(null);
                     for(let i=0; i < Math.min(parsed.length, this.size); i++) {
                         this.items[i] = parsed[i];
                     }
                }
            } catch (e) {
                console.error("Failed to load inventory", e);
                this.items = new Array(this.size).fill(null);
            }
        }
    }

    clear() {
        this.items = new Array(this.size).fill(null);
        this.save();
    }
}

// Item Generator
const ItemGenerator = {
    generate() {
        const types = ['sword', 'potion', 'shield', 'ring', 'scroll'];
        const type = types[Math.floor(Math.random() * types.length)];
        const qualities = ['common', 'uncommon', 'rare', 'epic', 'legendary'];
        const quality = qualities[Math.floor(Math.random() * qualities.length)];
        
        const icons = {
            sword: '‚öîÔ∏è',
            potion: 'üß™',
            shield: 'üõ°Ô∏è',
            ring: 'üíç',
            scroll: 'üìú'
        };

        return {
            id: `item_${type}`,
            name: `${quality.charAt(0).toUpperCase() + quality.slice(1)} ${type.charAt(0).toUpperCase() + type.slice(1)}`,
            type: type,
            icon: icons[type],
            quality: quality,
            desc: `A ${quality} quality ${type}. Very useful!`,
            stackable: type === 'potion' || type === 'scroll',
            maxStack: 10,
            value: Math.floor(Math.random() * 100) + 10
        };
    }
};

// Dashboard System
class DashboardSystem {
    constructor() {
        this.isOpen = false;
        this.activeGroup = 'INVENTORY';
        this.activeTabId = 'items';
        this.inventory = new Inventory();
        
        if (this.inventory.getAll().every(i => !i)) {
             for(let i=0; i<10; i++) this.inventory.addItem(ItemGenerator.generate());
        }

        this.renderers = {};
    }

    init(groups, tabsConfig) {
        this.groups = groups;
        this.tabsConfig = tabsConfig;
        this.container = document.getElementById('dashboard-root');
        
        this.createDOM();
        this.setupEvents();
    }

    createDOM() {
        this.container.innerHTML = `
            <div class="dashboard-window">
                <nav class="dash-sidebar" id="dash-sidebar"></nav>
                <div class="dash-main">
                    <header class="dash-header">
                        <nav id="dash-subnav" style="display:flex; gap:30px;"></nav>
                        <div class="close-btn" id="btn-close">‚úï</div>
                    </header>
                    <main class="dash-content" id="dash-content"></main>
                </div>
            </div>
        `;
        
        this.renderSidebar();
    }

    renderSidebar() {
        const sidebar = document.getElementById('dash-sidebar');
        sidebar.innerHTML = '';
        
        Object.keys(this.groups).forEach(key => {
            const group = this.groups[key];
            const btn = document.createElement('div');
            btn.className = `cat-btn ${key === this.activeGroup ? 'active' : ''}`;
            btn.innerHTML = group.icon;
            btn.title = key;
            btn.onclick = () => this.switchGroup(key);
            sidebar.appendChild(btn);
        });
    }

    renderSubNav() {
        const subnav = document.getElementById('dash-subnav');
        subnav.innerHTML = '';
        
        const group = this.groups[this.activeGroup];
        group.tabs.forEach(tabId => {
            const tabConfig = this.tabsConfig.find(t => t.id === tabId);
            if (!tabConfig) return;
            
            const btn = document.createElement('div');
            btn.className = `sub-tab-btn ${tabId === this.activeTabId ? 'active' : ''}`;
            btn.innerText = tabConfig.label;
            btn.onclick = () => this.switchTab(tabId);
            subnav.appendChild(btn);
        });
    }

    switchGroup(groupKey) {
        this.activeGroup = groupKey;
        this.activeTabId = this.groups[groupKey].tabs[0];
        
        this.renderSidebar();
        this.renderSubNav();
        this.renderContent();
    }

    switchTab(tabId) {
        this.activeTabId = tabId;
        this.renderSubNav();
        this.renderContent();
    }

    renderContent() {
        const container = document.getElementById('dash-content');
        container.innerHTML = '';
        
        const tabConfig = this.tabsConfig.find(t => t.id === this.activeTabId);
        
        const renderFn = this.renderers[tabConfig.type] || this.renderers['info'];
        if (renderFn) {
            renderFn(container, tabConfig, this.inventory);
        }
    }

    registerRenderer(type, fn) {
        this.renderers[type] = fn;
    }

    setupEvents() {
        document.getElementById('btn-close').onclick = () => this.toggle();
        
        window.addEventListener('keydown', (e) => {
            if (e.key === 'Tab') {
                e.preventDefault();
                this.toggle();
            }
        });
    }

    toggle() {
        this.isOpen = !this.isOpen;
        if (this.isOpen) {
            this.container.classList.add('open');
            this.switchGroup(this.activeGroup);
        } else {
            this.container.classList.remove('open');
        }
    }
}

// Groups Config
const GROUPS = {
    'INVENTORY': {
        icon: 'üéí',
        tabs: ['items', 'gear', 'shop']
    },
    'PARTY': {
        icon: 'üë•',
        tabs: ['team', 'pets', 'skins', 'vehicles', 'ai']
    },
    'POWERS': {
        icon: '‚ö°',
        tabs: ['talents', 'skills', 'spirit', 'supernatural', 'alchemy']
    },
    'WORLD': {
        icon: 'üåç',
        tabs: ['quests', 'missions', 'bestiary', 'drops', 'map']
    },
    'SYSTEM': {
        icon: '‚öôÔ∏è',
        tabs: ['settings', 'controls']
    }
};

// Tabs Config
const TABS_CONFIG = [
    { id: "items", label: "Items", type: "grid" },
    { id: "gear", label: "Gear", type: "grid" },
    { id: "shop", label: "Shop", type: "grid" },
    
    { id: "team", label: "Team", type: "team" },
    { id: "pets", label: "Pets", type: "grid" },
    { id: "skins", label: "Skins", type: "grid" },
    { id: "vehicles", label: "Vehicles", type: "list" },
    { id: "ai", label: "AI", type: "info" },

    { id: "talents", label: "Talents", type: "tree" },
    { id: "skills", label: "Skills", type: "list" },
    { id: "spirit", label: "Spirit", type: "info" },
    { id: "supernatural", label: "Supernatural", type: "info" },
    { id: "alchemy", label: "Alchemy", type: "list" },

    { id: "quests", label: "Quests", type: "list" },
    { id: "missions", label: "Missions", type: "list" },
    { id: "bestiary", label: "Bestiary", type: "list" },
    { id: "drops", label: "Drops", type: "info" },
    { id: "map", label: "Map", type: "info" },

    { id: "settings", label: "Settings", type: "info" },
    { id: "controls", label: "Controls", type: "info" }
];

// Renderers
const Renderers = {
    grid: (container, tab, inventory) => {
        const grid = document.createElement('div');
        grid.className = 'item-grid';
        
        inventory.getAll().forEach(item => {
            const slot = document.createElement('div');
            slot.className = 'item-slot';
            if (item) {
                slot.innerHTML = `
                    <div>${item.icon}</div>
                    ${item.qty > 1 ? `<div class="qty">${item.qty}</div>` : ''}
                `;
            }
            grid.appendChild(slot);
        });
        
        container.appendChild(grid);
    },

    team: (container) => {
        const list = document.createElement('div');
        list.className = 'team-list';
        
        const members = [
            { name: "A1", role: "Warrior", icon: "üßî", color: "#3b82f6" },
            { name: "Missy", role: "Mage", icon: "üë©‚Äçüé§", color: "#a855f7" },
            { name: "Unique", role: "Rogue", icon: "ü•∑", color: "#f97316" }
        ];

        members.forEach(m => {
            const card = document.createElement('div');
            card.className = 'team-card';
            card.style.borderColor = m.color;
            card.innerHTML = `
                <div class="team-avatar" style="border-color:${m.color}">${m.icon}</div>
                <div class="team-name">${m.name}</div>
                <div class="team-role" style="color:${m.color}">${m.role}</div>
                <div style="width:100%; margin-top:auto;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-size:12px; color:#888;">
                        <span>HP</span> <span>100/100</span>
                    </div>
                    <div style="height:4px; background:#333; width:100%;"><div style="width:80%; height:100%; background:${m.color};"></div></div>
                </div>
            `;
            list.appendChild(card);
        });
        
        container.appendChild(list);
    },

    list: (container, tab) => {
        container.innerHTML = `<h3>${tab.label} List</h3>`;
        for(let i=0; i<5; i++) {
            container.innerHTML += `
                <div style="padding:15px; border-bottom:1px solid rgba(255,255,255,0.1); display:flex; justify-content:space-between;">
                    <span>Entry #${i+1}</span>
                    <span style="color:#666;">Details...</span>
                </div>
            `;
        }
    },

    info: (container, tab) => {
        container.innerHTML = `
            <div class="info-panel">
                <div style="font-size:60px; margin-bottom:20px;">${tab.type === 'tree' ? 'üå≥' : '‚ÑπÔ∏è'}</div>
                <h2>${tab.label}</h2>
                <p>This module renders generic info for ${tab.label}.</p>
            </div>
        `;
    }
};

// Initialize System
const sys = new DashboardSystem();

sys.registerRenderer('grid', Renderers.grid);
sys.registerRenderer('team', Renderers.team);
sys.registerRenderer('list', Renderers.list);
sys.registerRenderer('tree', Renderers.info);
sys.registerRenderer('info', Renderers.info);

sys.init(GROUPS, TABS_CONFIG);

window.DashboardSystem = sys;

document.getElementById('btn-dashboard').onclick = () => sys.toggle();

window.verifyState = () => {
    console.log(`Active Group: ${sys.activeGroup}, Active Tab: ${sys.activeTabId}`);
    return { group: sys.activeGroup, tab: sys.activeTabId };
};

// Canvas BG
const canvas = document.getElementById('bg-canvas');
const ctx = canvas.getContext('2d');
let w, h;
function resize() { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; }
window.onresize = resize;
resize();

function animate() {
    ctx.fillStyle = '#111';
    ctx.fillRect(0,0,w,h);
    
    const time = Date.now() * 0.001;
    for(let i=0; i<50; i++) {
        const x = (Math.sin(time + i) * 0.5 + 0.5) * w;
        const y = (Math.cos(time * 0.5 + i) * 0.5 + 0.5) * h;
        ctx.beginPath();
        ctx.arc(x, y, 2, 0, Math.PI*2);
        ctx.fillStyle = `rgba(59, 130, 246, ${Math.random()*0.5})`;
        ctx.fill();
    }
    requestAnimationFrame(animate);
}
animate();
    </script>
</body>
</html>
